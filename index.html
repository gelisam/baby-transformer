<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TensorFlow.js Classification</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm/dist/tf-backend-wasm.js"></script>
    <script type="module" src="main.js" defer></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        #status {
            margin: 20px 0;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        canvas {
            margin-top: 20px;
        }
        #loss-canvas {
            border: none;
        }
        .bordered-canvas {
            border: 1px solid #ddd;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
        }
        button:disabled:hover {
            background-color: #cccccc;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover button:disabled ~ .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background-color: #e7f3fe;
            border-left: 4px solid #2196F3;
        }
        #toaster {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #f44336;
            color: white;
            padding: 16px;
            border-radius: 8px;
            z-index: 1;
            display: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div id="toaster"></div>
    <h1>TensorFlow.js Sequence Prediction Demo</h1>
    <p>This model learns to predict the next token in sequences of the form "A=1 B=2 C=3", where each letter consistently maps to the same number within a sequence.</p>
    
    <div>
      <label for="backend-selector">Select Backend: </label>
      <select id="backend-selector">
        <option value="cpu" selected>CPU</option>
        <option value="wasm">WASM</option>
        <option value="webgl">GPU</option>
      </select>
    </div>
    <br/>
    <div>
      <div style="margin-bottom: 10px;">
        <label for="num-layers-slider">Number of Layers: <span id="num-layers-span">4</span></label>
        <input type="range" id="num-layers-slider" min="1" max="8" value="4" style="width: 200px; margin-left: 10px;">
      </div>
      <div>
        <label for="neurons-per-layer-slider">Neurons per Layer: <span id="neurons-per-layer-span">6</span></label>
        <input type="range" id="neurons-per-layer-slider" min="1" max="12" value="6" style="width: 200px; margin-left: 10px;">
      </div>
    </div>
    <br/>
    <button id="train-button">Train Model</button>
    <span class="tooltip" id="perfect-weights-tooltip">
      <button id="perfect-weights-button">Set Perfect Weights</button>
      <span class="tooltiptext" id="perfect-weights-tooltip-text"></span>
    </span>
    
    <div id="status">Click the button to start training...</div>
    
    <h3>Loss Curve</h3>
    <canvas id="loss-canvas" width="600" height="150"></canvas>
    <h3>Predictions</h3>
    <div style="margin-bottom: 10px;">
      <label for="input-format-selector">Input Format: </label>
      <select id="input-format-selector">
        <option value="number">number (e.g. 6)</option>
        <option value="one-hot">one hot (e.g. [0,0,0,0,0,1])</option>
        <option value="embedding" selected>embedding (e.g. [-0.5,10,-sqrt(3)/2])</option>
      </select>
    </div>
    <div style="margin-bottom: 10px;">
      <label for="output-format-selector">Output Format: </label>
      <select id="output-format-selector">
        <option value="number">number (e.g. 1.5)</option>
        <option value="probabilities" selected>probabilities (e.g. [0.33,0.33,0.34,0,0,0])</option>
        <option value="embedding">embedding (e.g. [10,-0.5,-sqrt(3)/2])</option>
      </select>
    </div>
    <div id="inputs-container" style="margin-bottom: 15px;">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 600px;">
            <input type="text" id="input-0" class="sequence-input" style="padding: 5px; font-family: monospace;">
            <input type="text" id="input-1" class="sequence-input" style="padding: 5px; font-family: monospace;">
            <input type="text" id="input-2" class="sequence-input" style="padding: 5px; font-family: monospace;">
            <input type="text" id="input-3" class="sequence-input" style="padding: 5px; font-family: monospace;">
            <input type="text" id="input-4" class="sequence-input" style="padding: 5px; font-family: monospace;">
            <input type="text" id="input-5" class="sequence-input" style="padding: 5px; font-family: monospace;">
        </div>
    </div>
    <canvas id="output-canvas" class="canvas" width="600" height="400"></canvas>
    <h3>Network Architecture</h3>
    <canvas id="network-canvas" class="canvas" width="600" height="420"></canvas>
</body>
</html>
